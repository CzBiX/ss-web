<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Shadowsocks</title>
    <link href="{{ static_url('css/index.css') }}" rel="stylesheet">
</head>
<body>
<h1>Shadowsocks Server</h1>
<div class="server_info">
    {% for name, value in config %}
    <div class="line">
        <label>{{name}}:
            <input value="{{value}}" type="text" readonly/>
        </label>
        {% if name == 'Password' %}
        <button id="new_password">New</button>
        {% end %}
    </div>
    {% end %}
    Running: <span id="status">...</span>
    <button id="start" disabled>Start</button>
    <button id="stop" disabled>Stop</button>
</div>
<script type="text/javascript" src="//lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>
<script type="application/javascript">
    var running = {{running}};
    $(function(){
        var $start = $('#start');
        var $stop = $('#stop');
        var $status = $('#status');
        var $newPassword = $('#new_password');

        updateStatus(running);

        $start.click(function(){
            disableBtn($start);
            sendAction('start');
        });

        $stop.click(function(){
            disableBtn($stop);
            sendAction('stop');
        });

        $newPassword.click(function(){
            sendAction('new_password').always(function(){
                location.reload();
            });
        });

        function sendAction(action) {
            $status.text('...');
            return $.post('/', {action: action}).success(function(data){
                updateStatus(data.running);
            }).error(function(){
                $status.text('Error');
            });
        }

        function updateStatus(running) {
            $status.text(running);
            if (running) {
                enableBtn($stop);
            } else {
                enableBtn($start);
            }
        }

        function enableBtn($el) {
            $el.prop('disabled', false);
        }

        function disableBtn($el) {
            $el.prop('disabled', true);
        }
    });
</script>
</body>
</html>